<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#4f46e5">
    <title>Êô∫ËÉΩËÆ∞Ë¥¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            overflow-x: hidden;
            position: relative;
        }
        
        body { 
            margin: 0; 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #f3f4f6;
            min-height: 100vh;
            padding-bottom: 0;
        }
        
        .container {
            max-width: 600px;
            margin: 0 auto;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .login-page {
            min-height: 100vh;
            background: linear-gradient(135deg, #dbeafe 0%, #c7d2fe 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .login-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
        }
        
        .login-icon {
            width: 64px;
            height: 64px;
            background: #4f46e5;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
        }
        
        h1 {
            font-size: 28px;
            color: #1f2937;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .subtitle {
            text-align: center;
            color: #6b7280;
            margin-bottom: 30px;
        }
        
        .input-group {
            position: relative;
            margin-bottom: 20px;
        }
        
        input {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 16px;
            outline: none;
            transition: border 0.3s;
        }
        
        input:focus {
            border-color: #4f46e5;
        }
        
        .input-with-icon {
            padding-right: 50px;
        }
        
        .eye-btn {
            position: absolute;
            right: 12px;
            top: 12px;
            background: none;
            border: none;
            cursor: pointer;
            color: #9ca3af;
        }
        
        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #4f46e5;
            color: white;
        }
        
        .btn-primary:hover {
            background: #4338ca;
        }
        
        .btn-green {
            background: #10b981;
            color: white;
        }
        
        .btn-green:hover {
            background: #059669;
        }
        
        .btn-red {
            background: #ef4444;
            color: white;
        }
        
        .btn-red:hover {
            background: #dc2626;
        }
        
        .btn-orange {
            background: #f97316;
            color: white;
        }
        
        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 60px 24px 24px 24px;
            border-radius: 0 0 30px 30px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .content {
            padding: 20px;
            padding-bottom: 90px;
            flex: 1;
        }
        
        .card {
            background: white;
            border-radius: 20px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 16px;
        }
        
        .asset-card {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .asset-amount {
            font-size: 36px;
            font-weight: bold;
            color: #1f2937;
        }
        
        .pool-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 16px;
        }
        
        .sub-pool-grid {
            display: flex;
            gap: 12px;
            margin-bottom: 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            padding-bottom: 8px;
        }
        
        .sub-pool-grid::-webkit-scrollbar {
            height: 4px;
        }
        
        .sub-pool-grid::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 2px;
        }
        
        .pool-card {
            padding: 24px;
            border-radius: 20px;
            color: white;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        
        .pool-green {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        }
        
        .pool-blue {
            background: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
        }
        
        .pool-title {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }
        
        .pool-amount {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .pool-subtitle {
            font-size: 12px;
            opacity: 0.75;
        }
        
        .sub-pool-card {
            padding: 16px;
            border-radius: 16px;
            color: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            min-width: 140px;
            flex-shrink: 0;
        }
        
        .sub-pool-vwce {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .sub-pool-cndx {
            background: linear-gradient(135deg, #34d399 0%, #10b981 100%);
        }
        
        .sub-pool-btc {
            background: linear-gradient(135deg, #6ee7b7 0%, #34d399 100%);
        }
        
        .sub-pool-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .sub-pool-name {
            font-size: 14px;
            font-weight: 600;
            opacity: 0.9;
        }
        
        .sub-pool-percent {
            font-size: 11px;
            opacity: 0.8;
        }
        
        .sub-pool-amount {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        
        .sub-pool-stats {
            font-size: 10px;
            opacity: 0.85;
            line-height: 1.6;
        }
        
        .card-title {
            font-size: 18px;
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 16px;
        }
        
        .transaction-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        
        .transaction-item:last-child {
            border-bottom: none;
        }
        
        .transaction-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .transaction-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .icon-green {
            background: #d1fae5;
            color: #10b981;
        }
        
        .icon-red {
            background: #fee2e2;
            color: #ef4444;
        }
        
        .icon-orange {
            background: #fed7aa;
            color: #f97316;
        }
        
        .transaction-info {
            flex: 1;
        }
        
        .transaction-desc {
            font-weight: 600;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .transaction-date {
            font-size: 12px;
            color: #9ca3af;
        }
        
        .transaction-amount {
            font-weight: bold;
            font-size: 16px;
        }
        
        .amount-green {
            color: #10b981;
        }
        
        .amount-red {
            color: #ef4444;
        }
        
        .amount-orange {
            color: #f97316;
        }
        
        .type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
            margin-bottom: 24px;
        }
        
        .type-btn {
            padding: 16px;
            border-radius: 12px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .type-btn.active-green {
            background: #10b981;
            color: white;
            box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
        }
        
        .type-btn.active-red {
            background: #ef4444;
            color: white;
            box-shadow: 0 4px 10px rgba(239, 68, 68, 0.3);
        }
        
        .type-btn.inactive {
            background: #f3f4f6;
            color: #6b7280;
        }
        
        .label {
            display: block;
            font-weight: 600;
            color: #374151;
            margin-bottom: 8px;
        }
        
        .amount-input-wrapper {
            position: relative;
        }
        
        .amount-symbol {
            position: absolute;
            left: 16px;
            top: 16px;
            font-size: 20px;
            color: #9ca3af;
        }
        
        .amount-input {
            padding-left: 40px;
            font-size: 20px;
        }
        
        select {
            width: 100%;
            padding: 16px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            outline: none;
            background: white;
        }
        
        .info-box {
            background: #dbeafe;
            border: 1px solid #93c5fd;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        
        .info-text {
            font-size: 14px;
            color: #1e40af;
            line-height: 1.6;
        }
        
        .quick-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
            margin-bottom: 20px;
        }
        
        .quick-btn {
            padding: 10px;
            border: 2px solid #e5e7eb;
            background: white;
            border-radius: 10px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #374151;
        }
        
        .quick-btn:active {
            transform: scale(0.95);
        }
        
        .quick-btn-vwce {
            border-color: #10b981;
            color: #10b981;
        }
        
        .quick-btn-vwce:hover {
            background: #10b981;
            color: white;
        }
        
        .quick-btn-vwce.expense-mode {
            border-color: #ef4444;
            color: #ef4444;
        }
        
        .quick-btn-vwce.expense-mode:hover {
            background: #ef4444;
            color: white;
        }
        
        .quick-btn-cndx {
            border-color: #34d399;
            color: #059669;
        }
        
        .quick-btn-cndx:hover {
            background: #34d399;
            color: white;
        }
        
        .quick-btn-cndx.expense-mode {
            border-color: #f87171;
            color: #dc2626;
        }
        
        .quick-btn-cndx.expense-mode:hover {
            background: #f87171;
            color: white;
        }
        
        .quick-btn-btc {
            border-color: #6ee7b7;
            color: #047857;
        }
        
        .quick-btn-btc:hover {
            background: #6ee7b7;
            color: white;
        }
        
        .quick-btn-btc.expense-mode {
            border-color: #fca5a5;
            color: #b91c1c;
        }
        
        .quick-btn-btc.expense-mode:hover {
            background: #fca5a5;
            color: white;
        }c {
            border-color: #6ee7b7;
            color: #047857;
        }
        
        .quick-btn-btc:hover {
            background: #6ee7b7;
            color: white;
        }
        
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-top: 1px solid #e5e7eb;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            padding: 8px 8px 8px 8px;
            gap: 4px;
            z-index: 1000;
        }
        
        @supports (padding-bottom: env(safe-area-inset-bottom)) {
            .bottom-nav {
                padding-bottom: calc(8px + env(safe-area-inset-bottom));
            }
        }
        
        .nav-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px;
            border: none;
            background: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            color: #9ca3af;
        }
        
        .nav-btn.active {
            background: #eef2ff;
            color: #4f46e5;
        }
        
        .nav-label {
            font-size: 11px;
            margin-top: 4px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 8px;
            margin-left: 8px;
        }
        
        .delete-btn:hover {
            color: #ef4444;
        }
        
        .transaction-right {
            display: flex;
            align-items: center;
        }
        
        .history-card {
            background: white;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }
        
        .history-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }
        
        .history-left {
            display: flex;
            gap: 12px;
            flex: 1;
        }
        
        .history-details {
            flex: 1;
        }
        
        .history-title {
            font-weight: bold;
            color: #1f2937;
            margin-bottom: 4px;
        }
        
        .history-meta {
            font-size: 12px;
            color: #9ca3af;
            margin-top: 4px;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script>
        const icons = {
            home: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><path d="M9 22V12h6v10"/></svg>',
            plus: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M12 8v8M8 12h8"/></svg>',
            minus: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M8 12h8"/></svg>',
            history: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M12 7v5l4 2"/></svg>',
            settings: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>',
            eye: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>',
            eyeOff: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><path d="M1 1l22 22"/></svg>',
            lock: '<svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>',
            up: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 6l-9.5 9.5-5-5L1 18"/><path d="M17 6h6v6"/></svg>',
            down: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M23 18l-9.5-9.5-5 5L1 6"/><path d="M17 18h6v-6"/></svg>',
            edit: '<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M17 3a2.828 2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>',
            trash: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>',
            save: '<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><path d="M17 21v-8H7v8"/><path d="M7 3v5h8"/></svg>'
        };
        
        let state = {
            isLoggedIn: false,
            password: '',
            showPassword: false,
            currentPage: 'home',
            storedPassword: '123456',
            developmentPool: 0,
            discretionaryPool: 0,
            vwcePool: 0,
            cndxPool: 0,
            btcPool: 0,
            vwceStats: { totalIncome: 0, totalExpense: 0 },
            cndxStats: { totalIncome: 0, totalExpense: 0 },
            btcStats: { totalIncome: 0, totalExpense: 0 },
            transactions: [],
            recordType: 'income',
            amount: '',
            description: '',
            selectedPool: 'discretionary',
            newPassword: '',
            confirmPassword: '',
            correctionAmount: '',
            correctionPool: 'development'
        };
        
        function loadData() {
            try {
                const pwd = localStorage.getItem('password');
                if (pwd) state.storedPassword = pwd;

                const dev = localStorage.getItem('developmentPool');
                if (dev) state.developmentPool = parseFloat(dev);

                const disc = localStorage.getItem('discretionaryPool');
                if (disc) state.discretionaryPool = parseFloat(disc);
                
                const vwce = localStorage.getItem('vwcePool');
                if (vwce) state.vwcePool = parseFloat(vwce);
                
                const cndx = localStorage.getItem('cndxPool');
                if (cndx) state.cndxPool = parseFloat(cndx);
                
                const btc = localStorage.getItem('btcPool');
                if (btc) state.btcPool = parseFloat(btc);
                
                const vwceStats = localStorage.getItem('vwceStats');
                if (vwceStats) state.vwceStats = JSON.parse(vwceStats);
                
                const cndxStats = localStorage.getItem('cndxStats');
                if (cndxStats) state.cndxStats = JSON.parse(cndxStats);
                
                const btcStats = localStorage.getItem('btcStats');
                if (btcStats) state.btcStats = JSON.parse(btcStats);

                const tx = localStorage.getItem('transactions');
                if (tx) state.transactions = JSON.parse(tx);
            } catch (error) {
                console.log('ÂàùÊ¨°‰ΩøÁî®');
            }
        }
        
        function saveData() {
            try {
                localStorage.setItem('password', state.storedPassword);
                localStorage.setItem('developmentPool', state.developmentPool.toString());
                localStorage.setItem('discretionaryPool', state.discretionaryPool.toString());
                localStorage.setItem('vwcePool', state.vwcePool.toString());
                localStorage.setItem('cndxPool', state.cndxPool.toString());
                localStorage.setItem('btcPool', state.btcPool.toString());
                localStorage.setItem('vwceStats', JSON.stringify(state.vwceStats));
                localStorage.setItem('cndxStats', JSON.stringify(state.cndxStats));
                localStorage.setItem('btcStats', JSON.stringify(state.btcStats));
                localStorage.setItem('transactions', JSON.stringify(state.transactions));
            } catch (error) {
                console.error('‰øùÂ≠òÂ§±Ë¥•:', error);
            }
        }
        
        function handleLogin() {
            if (state.password === state.storedPassword) {
                state.isLoggedIn = true;
                state.password = '';
                render();
            } else {
                alert('ÂØÜÁ†ÅÈîôËØØÔºÅ');
            }
        }
        
        function handleAddRecord() {
            if (!state.amount || parseFloat(state.amount) <= 0) {
                alert('ËØ∑ËæìÂÖ•ÊúâÊïàÈáëÈ¢ù');
                return;
            }
            
            const amountNum = parseFloat(state.amount);
            const desc = state.description || (state.recordType === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫');
            
            let assetType = null;
            if (desc.includes('VWCE')) assetType = 'vwce';
            else if (desc.includes('CNDX')) assetType = 'cndx';
            else if (desc.includes('BTC')) assetType = 'btc';
            
            const newTx = {
                id: Date.now(),
                type: state.recordType,
                amount: amountNum,
                description: desc,
                pool: state.recordType === 'income' ? 'auto' : state.selectedPool,
                assetType: assetType,
                date: new Date().toLocaleString('zh-CN')
            };
            
            if (state.recordType === 'income') {
                const devAmount = amountNum * 0.9;
                const discAmount = amountNum * 0.1;
                state.developmentPool += devAmount;
                state.discretionaryPool += discAmount;
                
                const vwceAmount = devAmount * 0.6;
                const cndxAmount = devAmount * 0.35;
                const btcAmount = devAmount * 0.05;
                
                state.vwcePool += vwceAmount;
                state.cndxPool += cndxAmount;
                state.btcPool += btcAmount;
                
                if (assetType === 'vwce') {
                    state.vwceStats.totalIncome += amountNum;
                } else if (assetType === 'cndx') {
                    state.cndxStats.totalIncome += amountNum;
                } else if (assetType === 'btc') {
                    state.btcStats.totalIncome += amountNum;
                }
            } else {
                if (state.selectedPool === 'development') {
                    if (state.developmentPool >= amountNum) {
                        state.developmentPool -= amountNum;
                        
                        if (assetType === 'vwce' && state.vwcePool >= amountNum) {
                            state.vwcePool -= amountNum;
                            state.vwceStats.totalExpense += amountNum;
                        } else if (assetType === 'cndx' && state.cndxPool >= amountNum) {
                            state.cndxPool -= amountNum;
                            state.cndxStats.totalExpense += amountNum;
                        } else if (assetType === 'btc' && state.btcPool >= amountNum) {
                            state.btcPool -= amountNum;
                            state.btcStats.totalExpense += amountNum;
                        }
                    } else {
                        alert('ÂèëÂ±ïÈáë‰ΩôÈ¢ù‰∏çË∂≥ÔºÅ');
                        return;
                    }
                } else {
                    if (state.discretionaryPool >= amountNum) {
                        state.discretionaryPool -= amountNum;
                    } else {
                        alert('ÂèØÊîØÈÖçÈáë‰ΩôÈ¢ù‰∏çË∂≥ÔºÅ');
                        return;
                    }
                }
            }
            
            state.transactions.unshift(newTx);
            state.amount = '';
            state.description = '';
            state.currentPage = 'home';
            saveData();
            render();
        }
        
        function handleCorrection() {
            if (!state.correctionAmount) {
                alert('ËØ∑ËæìÂÖ•‰øÆÊ≠£ÈáëÈ¢ù');
                return;
            }
            
            const amountNum = parseFloat(state.correctionAmount);
            const newTx = {
                id: Date.now(),
                type: 'correction',
                amount: amountNum,
                description: 'ËµÑ‰∫ß‰øÆÊ≠£',
                pool: state.correctionPool,
                date: new Date().toLocaleString('zh-CN')
            };
            
            if (state.correctionPool === 'development') {
                state.developmentPool = amountNum;
            } else {
                state.discretionaryPool = amountNum;
            }
            
            state.transactions.unshift(newTx);
            state.correctionAmount = '';
            saveData();
            render();
            alert('ËµÑ‰∫ß‰øÆÊ≠£ÊàêÂäüÔºÅ');
        }
        
        function deleteTransaction(id) {
            if (confirm('Á°ÆÂÆöË¶ÅÂà†Èô§ËøôÊù°ËÆ∞ÂΩïÂêóÔºü')) {
                state.transactions = state.transactions.filter(t => t.id !== id);
                saveData();
                render();
            }
        }
        
        function handleChangePassword() {
            if (!state.newPassword || !state.confirmPassword) {
                alert('ËØ∑ËæìÂÖ•Êñ∞ÂØÜÁ†Å');
                return;
            }
            if (state.newPassword !== state.confirmPassword) {
                alert('‰∏§Ê¨°ÂØÜÁ†Å‰∏ç‰∏ÄËá¥');
                return;
            }
            state.storedPassword = state.newPassword;
            state.newPassword = '';
            state.confirmPassword = '';
            saveData();
            render();
            alert('ÂØÜÁ†Å‰øÆÊîπÊàêÂäüÔºÅ');
        }
        
        function handleLogout() {
            if (confirm('Á°ÆÂÆöË¶ÅÈÄÄÂá∫ÁôªÂΩïÂêóÔºü')) {
                state.isLoggedIn = false;
                state.currentPage = 'home';
                render();
            }
        }
        
        function render() {
            const root = document.getElementById('root');
            
            if (!state.isLoggedIn) {
                root.innerHTML = `
                    <div class="login-page">
                        <div class="login-card">
                            <div class="login-icon">${icons.lock}</div>
                            <h1>Êô∫ËÉΩËÆ∞Ë¥¶</h1>
                            <p class="subtitle">ËØ∑ËæìÂÖ•ÂØÜÁ†ÅÁôªÂΩï</p>
                            <div class="input-group">
                                <input 
                                    type="${state.showPassword ? 'text' : 'password'}" 
                                    id="passwordInput"
                                    placeholder="ËØ∑ËæìÂÖ•ÂØÜÁ†Å"
                                    class="input-with-icon"
                                    value="${state.password}"
                                />
                                <button class="eye-btn" onclick="togglePassword()">
                                    ${state.showPassword ? icons.eyeOff : icons.eye}
                                </button>
                            </div>
                            <button class="btn btn-primary" onclick="handleLogin()">ÁôªÂΩï</button>
                            <p style="text-align:center;color:#9ca3af;font-size:14px;margin-top:20px;">
                                ÈªòËÆ§ÂØÜÁ†Å: 123456
                            </p>
                        </div>
                    </div>
                `;
                
                document.getElementById('passwordInput').addEventListener('input', (e) => {
                    state.password = e.target.value;
                });
                
                document.getElementById('passwordInput').addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') handleLogin();
                });
                
                return;
            }
            
            const totalAssets = state.developmentPool + state.discretionaryPool;
            const totalSubPools = state.vwcePool + state.cndxPool + state.btcPool;
            
            let content = '';
            
            if (state.currentPage === 'home') {
                content = `
                    <div class="card">
                        <div class="asset-card">
                            <span style="color:#6b7280;">ÊÄªËµÑ‰∫ß</span>
                        </div>
                        <div class="asset-amount">‚Ç¨${totalAssets.toFixed(2)}</div>
                    </div>
                    
                    <div class="pool-grid">
                        <div class="pool-card pool-green">
                            <div class="pool-title">ÂèëÂ±ïÈáë</div>
                            <div class="pool-amount">‚Ç¨${state.developmentPool.toFixed(2)}</div>
                            <div class="pool-subtitle">90%Êî∂ÂÖ•</div>
                        </div>
                        
                        <div class="pool-card pool-blue">
                            <div class="pool-title">ÂèØÊîØÈÖçÈáë</div>
                            <div class="pool-amount">‚Ç¨${state.discretionaryPool.toFixed(2)}</div>
                            <div class="pool-subtitle">10%Êî∂ÂÖ•</div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">ÂèëÂ±ïÈáëËµÑ‰∫ßÂàÜÂ∏É</h3>
                        <div class="sub-pool-grid">
                            <div class="sub-pool-card sub-pool-vwce">
                                <div class="sub-pool-header">
                                    <div class="sub-pool-name">VWCE</div>
                                    <div class="sub-pool-percent">60%</div>
                                </div>
                                <div class="sub-pool-amount">‚Ç¨${state.vwcePool.toFixed(2)}</div>
                                <div class="sub-pool-stats">
                                    Êî∂ÂÖ•: ‚Ç¨${state.vwceStats.totalIncome.toFixed(2)}<br/>
                                    ÊîØÂá∫: ‚Ç¨${state.vwceStats.totalExpense.toFixed(2)}<br/>
                                    Áõà‰∫è: ‚Ç¨${(state.vwceStats.totalIncome - state.vwceStats.totalExpense).toFixed(2)}
                                </div>
                            </div>
                            <div class="sub-pool-card sub-pool-cndx">
                                <div class="sub-pool-header">
                                    <div class="sub-pool-name">CNDX</div>
                                    <div class="sub-pool-percent">35%</div>
                                </div>
                                <div class="sub-pool-amount">‚Ç¨${state.cndxPool.toFixed(2)}</div>
                                <div class="sub-pool-stats">
                                    Êî∂ÂÖ•: ‚Ç¨${state.cndxStats.totalIncome.toFixed(2)}<br/>
                                    ÊîØÂá∫: ‚Ç¨${state.cndxStats.totalExpense.toFixed(2)}<br/>
                                    Áõà‰∫è: ‚Ç¨${(state.cndxStats.totalIncome - state.cndxStats.totalExpense).toFixed(2)}
                                </div>
                            </div>
                            <div class="sub-pool-card sub-pool-btc">
                                <div class="sub-pool-header">
                                    <div class="sub-pool-name">BTC</div>
                                    <div class="sub-pool-percent">5%</div>
                                </div>
                                <div class="sub-pool-amount">‚Ç¨${state.btcPool.toFixed(2)}</div>
                                <div class="sub-pool-stats">
                                    Êî∂ÂÖ•: ‚Ç¨${state.btcStats.totalIncome.toFixed(2)}<br/>
                                    ÊîØÂá∫: ‚Ç¨${state.btcStats.totalExpense.toFixed(2)}<br/>
                                    Áõà‰∫è: ‚Ç¨${(state.btcStats.totalIncome - state.btcStats.totalExpense).toFixed(2)}
                                </div>
                            </div>
                        </div>
                        <div style="text-align:center;color:#6b7280;font-size:13px;padding-top:12px;border-top:1px solid #e5e7eb;margin-top:8px;">
                            ÊÄªÊäïËµÑ: ‚Ç¨${totalSubPools.toFixed(2)} | Áé∞Èáë‰ΩôÈ¢ù: ‚Ç¨${(state.developmentPool - totalSubPools).toFixed(2)}
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">ÊúÄËøë‰∫§Êòì</h3>
                        ${state.transactions.length === 0 ? 
                            '<p class="empty-state">ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï</p>' :
                            state.transactions.slice(0, 5).map(tx => `
                                <div class="transaction-item">
                                    <div class="transaction-left">
                                        <div class="transaction-icon icon-${tx.type === 'income' ? 'green' : tx.type === 'correction' ? 'orange' : 'red'}">
                                            ${tx.type === 'income' ? icons.up : tx.type === 'correction' ? icons.edit : icons.down}
                                        </div>
                                        <div class="transaction-info">
                                            <div class="transaction-desc">${tx.description}</div>
                                            <div class="transaction-date">${tx.date}</div>
                                        </div>
                                    </div>
                                    <div class="transaction-amount amount-${tx.type === 'income' ? 'green' : tx.type === 'correction' ? 'orange' : 'red'}">
                                        ${tx.type === 'income' ? '+' : tx.type === 'correction' ? '=' : '-'}‚Ç¨${tx.amount.toFixed(2)}
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                `;
            } else if (state.currentPage === 'add') {
                content = `
                    <div class="card">
                        <div class="type-selector">
                            <button 
                                class="type-btn ${state.recordType === 'income' ? 'active-green' : 'inactive'}"
                                onclick="setRecordType('income')"
                            >Êî∂ÂÖ•</button>
                            <button 
                                class="type-btn ${state.recordType === 'expense' ? 'active-red' : 'inactive'}"
                                onclick="setRecordType('expense')"
                            >ÊîØÂá∫</button>
                        </div>
                        
                        <div style="margin-bottom:16px;">
                            <label class="label">Âø´Êç∑Êìç‰Ωú</label>
                            <div class="quick-buttons">
                                <button class="quick-btn quick-btn-vwce ${state.recordType === 'expense' ? 'expense-mode' : ''}" onclick="fillQuick('VWCE')">
                                    ${state.recordType === 'income' ? 'ÂçñÂá∫' : '‰π∞ÂÖ•'} VWCE
                                </button>
                                <button class="quick-btn quick-btn-cndx ${state.recordType === 'expense' ? 'expense-mode' : ''}" onclick="fillQuick('CNDX')">
                                    ${state.recordType === 'income' ? 'ÂçñÂá∫' : '‰π∞ÂÖ•'} CNDX
                                </button>
                                <button class="quick-btn quick-btn-btc ${state.recordType === 'expense' ? 'expense-mode' : ''}" onclick="fillQuick('BTC')">
                                    ${state.recordType === 'income' ? 'ÂçñÂá∫' : '‰π∞ÂÖ•'} BTC
                                </button>
                            </div>
                        </div>
                        
                        <div style="margin-bottom:20px;">
                            <label class="label">ÈáëÈ¢ù</label>
                            <div class="amount-input-wrapper">
                                <span class="amount-symbol">‚Ç¨</span>
                                <input 
                                    type="number" 
                                    id="amountInput"
                                    class="amount-input"
                                    placeholder="0.00"
                                    value="${state.amount}"
                                />
                            </div>
                        </div>
                        
                        <div style="margin-bottom:20px;">
                            <label class="label">ÊèèËø∞</label>
                            <input 
                                type="text" 
                                id="descInput"
                                placeholder="${state.recordType === 'income' ? 'Êî∂ÂÖ•Êù•Ê∫ê' : 'ÊîØÂá∫Áî®ÈÄî'}"
                                value="${state.description}"
                            />
                        </div>
                        
                        ${state.recordType === 'expense' ? `
                            <div style="margin-bottom:20px;">
                                <label class="label">‰ΩøÁî®ËµÑÈáëÊ±†</label>
                                <select id="poolSelect" onchange="updateSelectedPool(this.value)">
                                    <option value="discretionary" ${state.selectedPool === 'discretionary' ? 'selected' : ''}>
                                        ÂèØÊîØÈÖçÈáë (‚Ç¨${state.discretionaryPool.toFixed(2)})
                                    </option>
                                    <option value="development" ${state.selectedPool === 'development' ? 'selected' : ''}>
                                        ÂèëÂ±ïÈáë (‚Ç¨${state.developmentPool.toFixed(2)})
                                    </option>
                                </select>
                            </div>
                        ` : ''}
                        
                        ${state.recordType === 'income' ? `
                            <div class="info-box">
                                <p class="info-text">
                                    üí° Êî∂ÂÖ•Â∞ÜËá™Âä®ÂàÜÈÖçÔºö<br/>
                                    ‚Ä¢ 90% ‚Üí ÂèëÂ±ïÈáë (VWCE 60%, CNDX 35%, BTC 5%)<br/>
                                    ‚Ä¢ 10% ‚Üí ÂèØÊîØÈÖçÈáë
                                </p>
                            </div>
                        ` : ''}
                        
                        <button 
                            class="btn ${state.recordType === 'income' ? 'btn-green' : 'btn-red'}"
                            onclick="handleAddRecord()"
                        >
                            Ê∑ªÂä†${state.recordType === 'income' ? 'Êî∂ÂÖ•' : 'ÊîØÂá∫'}
                        </button>
                    </div>
                `;
                
                setTimeout(() => {
                    const amountInput = document.getElementById('amountInput');
                    const descInput = document.getElementById('descInput');
                    
                    if (amountInput) {
                        amountInput.addEventListener('input', (e) => {
                            state.amount = e.target.value;
                        });
                    }
                    
                    if (descInput) {
                        descInput.addEventListener('input', (e) => {
                            state.description = e.target.value;
                        });
                    }
                }, 0);
            } else if (state.currentPage === 'history') {
                content = state.transactions.length === 0 ? 
                    '<div class="empty-state">' + icons.history + '<p style="margin-top:16px;">ÊöÇÊó†‰∫§ÊòìËÆ∞ÂΩï</p></div>' :
                    state.transactions.map(tx => `
                        <div class="history-card">
                            <div class="history-content">
                                <div class="history-left">
                                    <div class="transaction-icon icon-${tx.type === 'income' ? 'green' : tx.type === 'correction' ? 'orange' : 'red'}">
                                        ${tx.type === 'income' ? icons.up : tx.type === 'correction' ? icons.edit : icons.down}
                                    </div>
                                    <div class="history-details">
                                        <div class="history-title">${tx.description}</div>
                                        <div class="transaction-date">${tx.date}</div>
                                        <div class="history-meta">
                                            ${tx.type === 'income' ? 'Ëá™Âä®ÂàÜÈÖç' : 
                                              tx.type === 'expense' ? (tx.pool === 'development' ? 'ÂèëÂ±ïÈáë' : 'ÂèØÊîØÈÖçÈáë') :
                                              (tx.pool === 'development' ? 'ÂèëÂ±ïÈáë‰øÆÊ≠£' : 'ÂèØÊîØÈÖçÈáë‰øÆÊ≠£')}
                                        </div>
                                    </div>
                                </div>
                                <div class="transaction-right">
                                    <div class="transaction-amount amount-${tx.type === 'income' ? 'green' : tx.type === 'correction' ? 'orange' : 'red'}">
                                        ${tx.type === 'income' ? '+' : tx.type === 'correction' ? '=' : '-'}‚Ç¨${tx.amount.toFixed(2)}
                                    </div>
                                    <button class="delete-btn" onclick="deleteTransaction(${tx.id})">
                                        ${icons.trash}
                                    </button>
                                </div>
                            </div>
                        </div>
                    `).join('');
            } else if (state.currentPage === 'settings') {
                content = `
                    <div class="card">
                        <h3 class="card-title">ËµÑ‰∫ß‰øÆÊ≠£</h3>
                        <div style="margin-bottom:12px;">
                            <select id="correctionPool" onchange="updateCorrectionPool(this.value)">
                                <option value="development" ${state.correctionPool === 'development' ? 'selected' : ''}>ÂèëÂ±ïÈáë</option>
                                <option value="discretionary" ${state.correctionPool === 'discretionary' ? 'selected' : ''}>ÂèØÊîØÈÖçÈáë</option>
                            </select>
                        </div>
                        <div style="margin-bottom:12px;">
                            <input 
                                type="number" 
                                id="correctionAmount"
                                placeholder="ËæìÂÖ•‰øÆÊ≠£ÂêéÁöÑÈáëÈ¢ù"
                                value="${state.correctionAmount}"
                            />
                        </div>
                        <button class="btn btn-orange" onclick="handleCorrection()">ÊâßË°å‰øÆÊ≠£</button>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">‰øÆÊîπÂØÜÁ†Å</h3>
                        <div style="margin-bottom:12px;">
                            <input 
                                type="password" 
                                id="newPwdInput"
                                placeholder="ËæìÂÖ•Êñ∞ÂØÜÁ†Å"
                                value="${state.newPassword}"
                            />
                        </div>
                        <div style="margin-bottom:12px;">
                            <input 
                                type="password" 
                                id="confirmPwdInput"
                                placeholder="Á°ÆËÆ§Êñ∞ÂØÜÁ†Å"
                                value="${state.confirmPassword}"
                            />
                        </div>
                        <button class="btn btn-primary" onclick="handleChangePassword()">
                            <span style="display:inline-flex;align-items:center;gap:8px;">
                                ${icons.save}
                                <span>‰øùÂ≠òÂØÜÁ†Å</span>
                            </span>
                        </button>
                    </div>
                    
                    <div class="card">
                        <h3 class="card-title">ÂÖ≥‰∫é</h3>
                        <p style="color:#6b7280;font-size:14px;line-height:1.8;">
                            ‚Ä¢ ÁâàÊú¨: 1.0.0<br/>
                            ‚Ä¢ Êï∞ÊçÆËá™Âä®‰øùÂ≠ò<br/>
                            ‚Ä¢ Êî∂ÂÖ•Ëá™Âä®ÂàÜÈÖçÔºöÂèëÂ±ïÈáë90% (VWCE 60%, CNDX 35%, BTC 5%)ÔºåÂèØÊîØÈÖçÈáë10%
                        </p>
                    </div>
                    
                    <button class="btn btn-red" onclick="handleLogout()">ÈÄÄÂá∫ÁôªÂΩï</button>
                `;
                
                setTimeout(() => {
                    const corrAmountInput = document.getElementById('correctionAmount');
                    if (corrAmountInput) {
                        corrAmountInput.addEventListener('input', (e) => {
                            state.correctionAmount = e.target.value;
                        });
                    }
                    
                    const newPwdInput = document.getElementById('newPwdInput');
                    const confirmPwdInput = document.getElementById('confirmPwdInput');
                    
                    if (newPwdInput) {
                        newPwdInput.addEventListener('input', (e) => {
                            state.newPassword = e.target.value;
                        });
                    }
                    
                    if (confirmPwdInput) {
                        confirmPwdInput.addEventListener('input', (e) => {
                            state.confirmPassword = e.target.value;
                        });
                    }
                }, 0);
            }
            
            root.innerHTML = `
                <div class="container">
                    <div class="header">
                        <h1 style="font-size:24px;margin:0;">
                            ${state.currentPage === 'home' ? 'ËµÑ‰∫ßÊÄªËßà' :
                              state.currentPage === 'add' ? (state.recordType === 'income' ? 'Ê∑ªÂä†Êî∂ÂÖ•' : 'Ê∑ªÂä†ÊîØÂá∫') :
                              state.currentPage === 'history' ? '‰∫§ÊòìÂéÜÂè≤' : 'ËÆæÁΩÆ'}
                        </h1>
                    </div>
                    <div class="content">
                        ${content}
                    </div>
                    <div class="bottom-nav">
                        <button class="nav-btn ${state.currentPage === 'add' && state.recordType === 'income' ? 'active' : ''}" onclick="setPage('add'); setRecordType('income');">
                            ${icons.plus}
                            <span class="nav-label">Êî∂ÂÖ•</span>
                        </button>
                        <button class="nav-btn ${state.currentPage === 'add' && state.recordType === 'expense' ? 'active' : ''}" onclick="quickExpense()">
                            ${icons.minus}
                            <span class="nav-label">ÊîØÂá∫</span>
                        </button>
                        <button class="nav-btn ${state.currentPage === 'home' ? 'active' : ''}" onclick="setPage('home')">
                            ${icons.home}
                            <span class="nav-label">È¶ñÈ°µ</span>
                        </button>
                        <button class="nav-btn ${state.currentPage === 'history' ? 'active' : ''}" onclick="setPage('history')">
                            ${icons.history}
                            <span class="nav-label">ÂéÜÂè≤</span>
                        </button>
                        <button class="nav-btn ${state.currentPage === 'settings' ? 'active' : ''}" onclick="setPage('settings')">
                            ${icons.settings}
                            <span class="nav-label">ËÆæÁΩÆ</span>
                        </button>
                    </div>
                </div>
            `;
        }
        
        function togglePassword() {
            state.showPassword = !state.showPassword;
            render();
        }
        
        function setPage(page) {
            state.currentPage = page;
            render();
        }
        
        function setRecordType(type) {
            state.recordType = type;
            render();
        }
        
        function updateSelectedPool(pool) {
            state.selectedPool = pool;
        }
        
        function updateCorrectionPool(pool) {
            state.correctionPool = pool;
        }
        
        function quickExpense() {
            state.recordType = 'expense';
            state.currentPage = 'add';
            render();
        }
        
        function fillQuick(asset) {
            const action = state.recordType === 'income' ? 'ÂçñÂá∫' : '‰π∞ÂÖ•';
            state.description = `${action} ${asset}`;
            render();
            setTimeout(() => {
                const amountInput = document.getElementById('amountInput');
                if (amountInput) amountInput.focus();
            }, 100);
        }
        
        loadData();
        render();
    </script>
</body>
</html>
